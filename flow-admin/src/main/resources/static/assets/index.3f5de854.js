import{dk as G,c5 as $,V as k,a as K,w as E,x as W,h as L,a9 as z,O as q,dV as J,c1 as Q,K as X,T as Y,U as Z,c3 as ee,p as T,_ as B,cj as te,ap as F,aw as ne}from"./index.741c5d36.js";import{t as I}from"./throttleByAnimationFrame.40d5ccf9.js";function w(n){return n!==window?n.getBoundingClientRect():{top:0,bottom:window.innerHeight}}function _(n,e,t){if(t!==void 0&&e.top>n.top-t)return"".concat(t+e.top,"px")}function H(n,e,t){if(t!==void 0&&e.bottom<n.bottom+t){var a=window.innerHeight-e.bottom;return"".concat(t+a,"px")}}var R=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"],m=[];function j(n,e){if(!!n){var t=m.find(function(a){return a.target===n});t?t.affixList.push(e):(t={target:n,affixList:[e],eventHandlers:{}},m.push(t),R.forEach(function(a){t.eventHandlers[a]=G(n,a,function(){t.affixList.forEach(function(s){var y=s.exposed.lazyUpdatePosition;y()},(a==="touchstart"||a==="touchmove")&&$?{passive:!0}:!1)})}))}}function M(n){var e=m.find(function(t){var a=t.affixList.some(function(s){return s===n});return a&&(t.affixList=t.affixList.filter(function(s){return s!==n})),a});e&&e.affixList.length===0&&(m=m.filter(function(t){return t!==e}),R.forEach(function(t){var a=e.eventHandlers[t];a&&a.remove&&a.remove()}))}function ae(){return typeof window!="undefined"?window:null}var p;(function(n){n[n.None=0]="None",n[n.Prepare=1]="Prepare"})(p||(p={}));var ie=function(){return{offsetTop:Number,offsetBottom:Number,target:{type:Function,default:ae},prefixCls:String,onChange:Function,onTestUpdatePosition:Function}},re=K({compatConfig:{MODE:3},name:"AAffix",props:ie(),setup:function(e,t){var a=t.slots,s=t.emit,y=t.expose,h=E(),P=E(),f=W({affixStyle:void 0,placeholderStyle:void 0,status:p.None,lastAffix:!1,prevTarget:null,timeout:null}),x=ne(),S=L(function(){return e.offsetBottom===void 0&&e.offsetTop===void 0?0:e.offsetTop}),b=L(function(){return e.offsetBottom}),V=function(){var r=f.status,v=f.lastAffix,d=e.target;if(!(r!==p.Prepare||!P.value||!h.value||!d)){var l=d();if(!!l){var o={status:p.None},g=w(l),u=w(h.value),N=_(u,g,S.value),U=H(u,g,b.value);N!==void 0?(o.affixStyle={position:"fixed",top:N,width:u.width+"px",height:u.height+"px"},o.placeholderStyle={width:u.width+"px",height:u.height+"px"}):U!==void 0&&(o.affixStyle={position:"fixed",bottom:U,width:u.width+"px",height:u.height+"px"},o.placeholderStyle={width:u.width+"px",height:u.height+"px"}),o.lastAffix=!!o.affixStyle,v!==o.lastAffix&&s("change",o.lastAffix),F(f,o)}}},C=function(){F(f,{status:p.Prepare,affixStyle:void 0,placeholderStyle:void 0}),x.update()},c=I(function(){C()}),A=I(function(){var i=e.target,r=f.affixStyle;if(i&&r){var v=i();if(v&&h.value){var d=w(v),l=w(h.value),o=_(l,d,S.value),g=H(l,d,b.value);if(o!==void 0&&r.top===o||g!==void 0&&r.bottom===g)return}}C()});y({updatePosition:c,lazyUpdatePosition:A}),z(function(){return e.target},function(i){var r=(i==null?void 0:i())||null;f.prevTarget!==r&&(M(x),r&&(j(r,x),c()),f.prevTarget=r)}),z(function(){return[e.offsetTop,e.offsetBottom]},c),q(function(){var i=e.target;i&&(f.timeout=setTimeout(function(){j(i(),x),c()}))}),J(function(){V()}),Q(function(){clearTimeout(f.timeout),M(x),c.cancel(),A.cancel()});var O=X("affix",e),D=O.prefixCls;return function(){var i,r=f.affixStyle,v=f.placeholderStyle,d=Y(Z({},D.value,r)),l=ee(e,["prefixCls","offsetTop","offsetBottom","target","onChange","onTestUpdatePosition"]);return T(te,{onResize:c},{default:function(){return[T("div",B(B({},l),{},{style:v,ref:h}),[T("div",{class:d,ref:P,style:r},[(i=a.default)===null||i===void 0?void 0:i.call(a)])])]}})}}}),ue=k(re);export{ue as A};
