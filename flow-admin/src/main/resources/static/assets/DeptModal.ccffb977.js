var q=Object.defineProperty;var P=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var S=(e,o,t)=>o in e?q(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,b=(e,o)=>{for(var t in o||(o={}))$.call(o,t)&&S(e,t,o[t]);if(P)for(var t of P(o))O.call(o,t)&&S(e,t,o[t]);return e};var m=(e,o,t)=>new Promise((f,d)=>{var F=u=>{try{s(t.next(u))}catch(l){d(l)}},r=u=>{try{s(t.throw(u))}catch(l){d(l)}},s=u=>u.done?f(u.value):Promise.resolve(u.value).then(F,r);s((t=t.apply(e,o)).next())});import{B as V,b as j,a as U}from"./index.ef1baeca.js";import{B as z}from"./BasicForm.35bf3188.js";import{u as W}from"./useForm.8dec0b63.js";import{c as G,s as H}from"./dept.b36be69a.js";import{g as J}from"./company.7aeaddd9.js";import{az as K,a as Q,D as X,w,j as y,h as Y,aB as p,o as I,k as N,B as E,p as D,C as _,t as M,l as Z,aC as ee}from"./index.741c5d36.js";import{T as te}from"./index.abe396df.js";import ae from"./index.5320b86d.js";import{F as oe}from"./constantEnum.bf6653fb.js";const Be=[{title:"\u540D\u79F0",dataIndex:"name",align:"left"},{title:"\u7F16\u7801",dataIndex:"code",width:120,align:"left"},{title:"\u90E8\u95E8\u9886\u5BFC",dataIndex:"leaderName",width:120,align:"left",customRender:({record:e})=>e.leaderCode?`${e.leaderName||""}[${e.leaderCode}]`:"\u672A\u8BBE\u7F6E"},{title:"\u6240\u5C5E\u516C\u53F8",dataIndex:"companyName",width:120,align:"left"},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",width:180}],he=[{field:"keyword",label:"\u5173\u952E\u5B57",component:"Input",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0/\u6807\u8BC6"},labelWidth:60,colProps:{span:6,lg:{span:8,offset:0},sm:{span:14,offset:0},xs:{span:16,offset:0}}}],ue=[{field:"id",label:"ID",required:!1,component:"Input",show:!1},{field:"pid",label:"pid",required:!1,component:"Input",show:!1},{field:"name",label:"\u540D\u79F0",component:"Input",required:!0,rules:[{required:!0,whitespace:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01"},{max:100,message:"\u5B57\u7B26\u957F\u5EA6\u4E0D\u80FD\u5927\u4E8E100\uFF01"}],colProps:{span:24}},{field:"code",label:"\u7F16\u7801",component:"Input",required:!0,colProps:{span:24}},{field:"leaderCode",label:"\u90E8\u95E8\u9886\u5BFC",component:"Input",slot:"settingLeader",required:!1,colProps:{span:24}},{field:"leaderName",label:"\u90E8\u95E8\u9886\u5BFC",component:"Input",show:!1},{field:"companyId",label:"\u6240\u5C5E\u516C\u53F8",component:"TreeSelect",componentProps:{treeNodeFilterProp:"cname",replaceFields:{title:"cname",key:"id",value:"id"},getPopupContainer:()=>document.body},required:!0,colProps:{span:24}},{field:"orderNo",label:"\u6392\u5E8F\u53F7",required:!1,component:"InputNumber"},{label:"\u5907\u6CE8",field:"note",component:"InputTextArea",rules:[{max:256,message:"\u5B57\u7B26\u957F\u5EA6\u4E0D\u80FD\u5927\u4E8E256\uFF01"}],colProps:{span:24}}],ne=Q({name:"DeptModal",components:{BasicModal:V,BasicForm:z,PersonalSelector:ae,Button:X,Tag:te},emits:["success","register"],setup(e,{emit:o}){const t=w(!0),[f,{openModal:d,setModalProps:F}]=j(),r=w([]),[s,{setFieldsValue:u,updateSchema:l,resetFields:B,validate:c}]=W({labelWidth:100,schemas:ue,showActionButtonGroup:!1,actionColOptions:{span:23}}),g=a=>[{trigger:"blur",validator:(i,n)=>n?G({id:a.id,field:a.field,fieldValue:n,fieldName:a.fieldName}).then(C=>C?Promise.resolve():Promise.reject(a.fieldName+"\u5DF2\u5B58\u5728\uFF0C\u8BF7\u4FEE\u6539\uFF01")).catch(C=>Promise.reject(C)):Promise.resolve()}],[v,{setModalProps:h,closeModal:k}]=U(a=>m(this,null,function*(){yield B(),h({confirmLoading:!1}),t.value=!!(a!=null&&a.isUpdate);const i=yield J();let n=a.record;n.id&&n.leaderCode?r.value=[{code:n.leaderCode,name:n.leaderName}]:r.value=[],yield l([{field:"companyId",componentProps:{treeData:i}},{field:"code",dynamicRules:()=>[{required:!0,whitespace:!0,message:"\u7F16\u7801\u4E0D\u80FD\u4E3A\u7A7A\uFF01"},{pattern:new RegExp(oe.SN),type:"string",message:"\u8BF7\u8F93\u5165\u82F1\u6587\u6216\u6570\u5B57\uFF01"},{max:64,message:"\u5B57\u7B26\u957F\u5EA6\u4E0D\u80FD\u5927\u4E8E64\uFF01"},...g({id:y(t)&&n&&n.id||"",field:"code",fieldValue:"",fieldName:"\u7F16\u7801"})]}]),y(t)?u(b({},a.record)):n.companyId&&u({companyId:n.companyId})})),A=Y(()=>y(t)?"\u4FEE\u6539\u90E8\u95E8":"\u65B0\u589E\u90E8\u95E8");function L(){d(!0,{selectorProps:{multiSelect:!1,selectedList:r.value}}),F({title:"\u8BBE\u7F6E\u90E8\u95E8\u9886\u5BFC",bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})}function x(a){return m(this,null,function*(){r.value=a.map(i=>({id:i.id,code:i.code,name:i.name})),a&&a.length>0?u({leaderCode:a[0].code,leaderName:a[0].name}):u({leaderCode:"",leaderName:""})})}function T(){return m(this,null,function*(){u({leaderCode:"",leaderName:""}),r.value=[]})}function R(){return m(this,null,function*(){try{h({confirmLoading:!0});const a=yield c();yield H(a),k(),o("success")}finally{h({confirmLoading:!1})}})}return{registerModal:v,registerForm:s,getTitle:A,registerPersonalModal:f,selectedPersonList:r,handleDeleteLeader:T,handleSettingLeader:L,handleSubmit:R,handleSettingLeaderSuccess:x}}});function re(e,o,t,f,d,F){const r=p("Tag"),s=p("Button"),u=p("BasicForm"),l=p("PersonalSelector"),B=p("BasicModal");return I(),N(B,ee(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:E(()=>[D(u,{onRegister:e.registerForm},{settingLeader:E(({model:c,field:g})=>[c[g]?(I(),N(r,{key:0,closable:"",onClose:e.handleDeleteLeader},{default:E(()=>[_(M(c.leaderName)+"["+M(c[g])+"] ",1)]),_:2},1032,["onClose"])):Z("",!0),D(s,{style:{width:"110px"},type:"link",onClick:e.handleSettingLeader},{default:E(()=>[_("\u8BBE\u7F6E\u9886\u5BFC")]),_:1},8,["onClick"])]),_:1},8,["onRegister"]),D(l,{onRegister:e.registerPersonalModal,onSuccess:e.handleSettingLeaderSuccess},null,8,["onRegister","onSuccess"])]),_:1},16,["onRegister","title","onOk"])}var se=K(ne,[["render",re]]),Ce=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));export{se as D,Ce as a,Be as c,he as s};
