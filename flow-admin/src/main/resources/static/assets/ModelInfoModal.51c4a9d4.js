var te=Object.defineProperty;var J=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var W=(e,s,t)=>s in e?te(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,$=(e,s)=>{for(var t in s||(s={}))se.call(s,t)&&W(e,t,s[t]);if(J)for(var t of J(s))ne.call(s,t)&&W(e,t,s[t]);return e};var T=(e,s,t)=>new Promise((n,d)=>{var y=r=>{try{p(t.next(r))}catch(g){d(g)}},c=r=>{try{p(t.throw(r))}catch(g){d(g)}},p=r=>r.done?n(r.value):Promise.resolve(r.value).then(y,c);p((t=t.apply(e,s)).next())});import{bU as ae,dO as V,az as re,a as le,D as ie,c9 as ue,w as m,j as u,an as de,h as me,a9 as fe,aB as h,o as ce,k as pe,B as v,n as f,t as x,p as B,C as S,y as k,z as O,aC as ge,G as Fe}from"./index.741c5d36.js";import{B as Be,a as ve}from"./index.ef1baeca.js";import{B as ye}from"./BasicForm.35bf3188.js";import{u as he}from"./useForm.8dec0b63.js";import{T as we}from"./index.abe396df.js";import{c as G,g as De,e as _e}from"./modelInfo.de66f1bc.js";import{a as Ie}from"./app.369d282d.js";import{R as U}from"./index.d4ff1276.js";import Ee from"./index.260a512e.js";const Ye=[{title:"\u540D\u79F0",dataIndex:"name",align:"left"},{title:"KEY",dataIndex:"modelKey",width:100,align:"left"},{title:"\u5206\u7C7B\u540D\u79F0",dataIndex:"categoryName",width:100,align:"left"},{title:"\u7CFB\u7EDF",dataIndex:"appName",width:100,align:"left"},{title:"\u5E94\u7528\u8303\u56F4",dataIndex:"appliedRangeName",width:100,align:"left"},{title:"\u72B6\u6001",dataIndex:"statusName",width:70,align:"center",customRender:({record:e})=>{const{status:s,statusName:t}=e;var n="";return~~s===2?n="warning":~~s===3?n="success":~~s===4?n="error":n="gray",ae(we,{color:n},()=>t)}},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"updateTime",width:120,align:"left"}],Qe=[{field:"keyword",label:"\u5173\u952E\u5B57",component:"Input",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0/\u7F16\u7801"},labelWidth:60,colProps:{span:6,lg:{span:6,offset:0},sm:{span:10,offset:0},xs:{span:16,offset:0}}},{field:"appSn",label:"\u7CFB\u7EDF",component:"Select",labelWidth:60,colProps:{span:6,lg:{span:6,offset:0},sm:{span:10,offset:0},xs:{span:16,offset:0}}}],be=[{field:"id",label:"ID",required:!1,component:"Input",show:!1},{field:"appSn",label:"\u6240\u5C5E\u7CFB\u7EDF",component:"Select",componentProps:{getPopupContainer:()=>document.body},required:!0,colProps:{span:24}}],Re=e=>V.get({url:"/flow/form/formInfo/getFormInfoByModelKey?modelKey="+e}),Ce=e=>V.post({url:"/flow/form/formInfo/saveOrUpdate",params:e},{isReturnNativeResponse:!0});const{createMessage:I}=Fe(),Me=le({name:"ModelInfoModal",components:{FramePage:Ee,Button:ie,CloseOutlined:ue,BasicModal:Be,BasicForm:ye,Radio:U,RadioGroup:U.Group,RadioButton:U.Button},emits:["success","register"],setup(e,{emit:s}){const t=m(!1),n=m({}),d=m({}),y=m("formDesigner"),c=m(""),p=m(""),r=m(),g=m(),w=m(!1),[P,{setFieldsValue:E,updateSchema:K,resetFields:z,validate:L}]=he({labelWidth:100,schemas:be,showActionButtonGroup:!1,showResetButton:!1,submitButtonOptions:{text:"\u4FDD\u5B58"},actionColOptions:{span:14}}),q=o=>[{trigger:"blur",validator:(F,a)=>a?_e({id:o.id,field:o.field,fieldValue:a,fieldName:o.fieldName}).then(l=>l?Promise.resolve():Promise.reject(o.fieldName+"\u5DF2\u5B58\u5728\uFF0C\u8BF7\u4FEE\u6539\uFF01")).catch(l=>Promise.reject(l)):Promise.resolve()}];window.submitFormInfo=o=>{var b;const{id:F,categoryCode:a}=u(d),l={id:(b=u(n))==null?void 0:b.id,code:o.modelKey,name:o.modelName,title:o.modelName,formJson:o.formJson,categoryCode:a},A={id:F,modelKey:o.modelKey,name:o.modelName,categoryCode:a};return G(A).then(R=>{const{data:{success:i,msg:_,data:j}}=R;if(i)Ce(l).then(ee=>{const{data:{success:oe,msg:C,data:M}}=ee;return oe?(I.success({content:C,style:{marginTop:"10vh"}}),d.value=j,n.value={id:M.id,modelKey:M.code,modelName:M.name,formJson:M.formJson},E({id:j.id}),Promise.resolve(C)):(I.error({content:C,style:{marginTop:"10vh"}}),Promise.reject(C))});else return I.error({content:_,style:{marginTop:"10vh"}}),Promise.reject(_)})};const[Z,{setModalProps:N,changeLoading:D,closeModal:H}]=ve(o=>T(this,null,function*(){z(),w.value=!1,N({confirmLoading:!1}),t.value=!!(o!=null&&o.isUpdate),D(!0);let F=null;y.value="formDesigner";const{modelKey:a,name:l,categoryCode:A,modelId:b}=o.record;if(d.value=o.record,p.value="/form-making/index.html?isDev=true&modelKey="+b,n.value={modelKey:a,modelName:l,formJson:"",categoryCode:A},a){const i=yield Re(a);i&&(n.value={id:i.id,modelKey:i.code,modelName:i.name,formJson:i.formJson})}de(()=>{setTimeout(()=>{var _;const i=u(u(r).frameRef);i&&((_=i.contentWindow)!=null&&_.vueObj&&i.contentWindow.CustomForm.loadFormInfo(u(n)),i.onload=function(){i.contentWindow.CustomForm.loadFormInfo(u(n))})},0)});try{F=yield Ie()}finally{D(!1)}let R=o.record;yield K([{field:"appSn",componentProps:{options:F,labelField:"id"}},{field:"modelKey",dynamicRules:()=>[{required:!0,whitespace:!0,message:"\u7F16\u7801\u4E0D\u80FD\u4E3A\u7A7A\uFF01"},{pattern:new RegExp("^[a-zA-Z_]{1,}[0-9a-zA-Z_]{1,}$"),type:"string",message:"\u8BF7\u8F93\u5165\u82F1\u6587\u6216\u6570\u5B57\u4E14\u4EE5\u82F1\u6587\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF01"},{max:150,message:"\u5B57\u7B26\u957F\u5EA6\u4E0D\u80FD\u5927\u4E8E150\uFF01"},...q({id:u(t)&&R&&R.id||"",field:"modelKey",fieldValue:"",fieldName:"\u7F16\u7801"})]}]),E($({},o.record))})),Y=me(()=>u(t)?"\u7F16\u8F91":"\u65B0\u589E");function Q(){H()}fe(y,(o,F)=>{const{modelId:a}=d.value;if(o==="flowDesigner"){if(!w.value){D(!0),c.value="/flow-bpmn/index.html/#/bpmn/designer?modelId="+a;const l=u(u(g).frameRef);setTimeout(()=>{l.contentWindow.location.reload(!0),D(!1)},100)}w.value=!0}else o==="baseSetting"&&De(a).then(l=>{l.version>0&&K({field:"appSn",componentProps:{disabled:!0},helpMessage:"\u5DF2\u53D1\u5E03\u7684\u6D41\u7A0B\u4E0D\u5141\u8BB8\u4FEE\u6539\u6240\u5C5E\u7CFB\u7EDF\uFF01"})})});function X(){return T(this,null,function*(){try{N({confirmLoading:!0});const o=yield L(),F=yield G(o),{data:{msg:a,success:l}}=F;l?(I.success({content:a,style:{marginTop:"10vh"}}),K({field:"appSn",componentProps:{disabled:!0}})):I.error({content:a,style:{marginTop:"10vh"}})}finally{D(!1),N({confirmLoading:!1})}})}return{registerModal:Z,registerForm:P,flowDesignerUrl:c,formDesignerUrl:p,flowDesignerRef:g,formDesignerRef:r,getTitle:Y,activityKey:y,flowBaseInfo:d,isUpdate:t,handleCloseModal:Q,handleSubmit:X}}}),Se={class:"flow-form-title"},Pe={class:"title"},Ke={class:"ctrl"},Ne=f("div",{class:"close"},null,-1),Ae={class:"designer-container form"},Te={class:"designer-container flow"},ke={class:"designer-container setting"},Oe={style:{width:"800px",margin:"auto"}},Ue={class:"mt-4 text-center"};function je(e,s,t,n,d,y){const c=h("RadioButton"),p=h("RadioGroup"),r=h("FramePage"),g=h("BasicForm"),w=h("Button"),P=h("BasicModal");return ce(),pe(P,ge({wrapClassName:"form-flow-designer"},e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit,onCancel:e.handleCloseModal}),{title:v(()=>[f("div",Se,[f("div",Pe,x(e.isUpdate?"\u7F16\u8F91\u6D41\u7A0B":"\u521B\u5EFA\u6D41\u7A0B")+"- "+x(e.flowBaseInfo.name),1),f("div",Ke,[B(p,{value:e.activityKey,"onUpdate:value":s[0]||(s[0]=E=>e.activityKey=E),buttonStyle:"solid"},{default:v(()=>[B(c,{value:"formDesigner"},{default:v(()=>[S(" \u8868\u5355\u8BBE\u8BA1 ")]),_:1}),B(c,{disabled:!e.flowBaseInfo.id,value:"flowDesigner"},{default:v(()=>[S(" \u6D41\u7A0B\u8BBE\u8BA1 ")]),_:1},8,["disabled"]),B(c,{disabled:!e.flowBaseInfo.id,value:"baseSetting"},{default:v(()=>[S(" \u6269\u5C55\u8BBE\u7F6E ")]),_:1},8,["disabled"])]),_:1},8,["value"])]),Ne])]),default:v(()=>[k(f("div",Ae,[B(r,{ref:"formDesignerRef",frameSrc:e.formDesignerUrl},null,8,["frameSrc"])],512),[[O,e.activityKey==="formDesigner"]]),k(f("div",Te,[B(r,{ref:"flowDesignerRef",frameSrc:e.flowDesignerUrl},null,8,["frameSrc"])],512),[[O,e.activityKey==="flowDesigner"]]),k(f("div",ke,[f("div",Oe,[B(g,{onRegister:e.registerForm},null,8,["onRegister"]),f("div",Ue,[B(w,{onClick:e.handleSubmit,type:"primary"},{default:v(()=>[S("\u4FDD\u5B58")]),_:1},8,["onClick"])])])],512),[[O,e.activityKey==="baseSetting"]])]),_:1},16,["onRegister","title","onOk","onCancel"])}var Je=re(Me,[["render",je]]),Xe=Object.freeze(Object.defineProperty({__proto__:null,default:Je},Symbol.toStringTag,{value:"Module"}));export{Je as M,Xe as a,Ye as c,Qe as s};
